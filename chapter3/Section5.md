åœ¨é¡¹ç›®å¼€å‘ä¸­é‡åˆ°ä¸ªæ¯”è¾ƒç‰¹æ®Šçš„éœ€æ±‚ï¼Œå³ä¸€ä¸‹å›¾æ‰€æ˜¾ç¤ºçš„  
![](http://ozjlhf9e0.bkt.clouddn.com/20180301151989207821299.png)  

ç¬¬ä¸€ğŸ‘çœ‹åˆ°è¿™æ ·çš„å›¾     
![](http://ozjlhf9e0.bkt.clouddn.com/20180301151989209420902.jpg)  
ç¬¬ä¸€æ¬¡æ²Ÿé€š    
 
![](http://ozjlhf9e0.bkt.clouddn.com/20180301151989210472882.png)   

ç¬¬äºŒæ¬¡--å’ 

![](http://ozjlhf9e0.bkt.clouddn.com/20180301151989211454259.jpg)    


ç¬¬ä¸‰æ¬¡   
![](http://ozjlhf9e0.bkt.clouddn.com/20180301151989212715892.jpg)


__ç¼˜ç”±__  
è®¾è®¡å¸ˆè®¤ä¸ºå½“å‰è‹¹æœçš„åŸºäºå¯¼èˆªæ å·¦ä¾§è¿”å›çš„æ–¹å¼åœ¨å¤§å±å¹•æ‰‹æœºä¸Šæ“ä½œï¼Œç”¨æˆ·éœ€è¦é€šè¿‡åŒæ‰‹æ‰èƒ½æ›´å¥½çš„æ“ä½œï¼Œå•æ‰‹æ“ä½œæ—¶å¹¶ä¸èƒ½å¾ˆå¥½çš„ä»å·¦è¾¹è¿”å›ä»¥åŠå®¹æ˜“æ‰åœ°ä¸Š ï¼Œå•Šå“ˆå“ˆ  æ‰€ä»¥æƒ³æ‰“ç ´ä¼ ç»Ÿçš„è®¾è®¡ï¼Œè®¾è®¡äº†è¿”å›æŒ‰é’®åœ¨å³è¾¹çš„æ–¹å¼(__ğŸ˜‚å¼€å‘__), ä½œä¸ºä¸€ä¸ªè‹¦é€¼å¼€å‘ï¼Œäº‰å–æ— æœåï¼Œé‚£å°±åªèƒ½ å»å®ç°å–½ 


###åˆ†æ  
ä»è¡¨é¢ä¸Šçœ‹ï¼Œåªæ˜¯æ›´æ”¹é‡Œç³»ç»Ÿå¯¼èˆªæ§åˆ¶å™¨itemæŒ‰é’®çš„ä½ç½®  __ä½†æ˜¯ã€‚ã€‚ã€‚ã€‚ã€‚__  
###ç¬¬ä¸€æ¬¡å°è¯•----ä¿®æ”¹é¡¶éƒ¨æŒ‰é’®ä½ç½®  
å½“æ—¶æƒ³é€šè¿‡ç®€å•çš„ä¿®æ”¹æŒ‰é’®çš„ä½ç½®æ¥è¾¾åˆ°æ¶ˆæ¯ï¼Œä½†æ˜¯ã€‚ã€‚ã€‚ã€‚æ§åˆ¶å™¨åœ¨pushä¸popæ“ä½œæ—¶ï¼Œåº”è¯¥å¦‚ä½•ä¿®æ”¹é¡¶éƒ¨çš„æŒ‰é’®    

* é—®é¢˜1 ï¼š å¦‚ä½•ä¿æŒè¿”å›æŒ‰é’®æ°¸è¿œåœ¨æ§åˆ¶å™¨ä¸Šï¼Œå¹¶ä¸”å¯¼èˆªæ§åˆ¶å™¨çš„æ ¹æ§åˆ¶å™¨ä¸Šä¸å­˜åœ¨  
* é—®é¢˜2 : æœ‰äº›ç•Œé¢æœ‰æ›´å¤šæŒ‰é’®ï¼Œæœ‰äº›ç•Œé¢æ— æ›´å¤šæŒ‰é’®ï¼Œå¦‚ä½•å¤„ç†   

###ç¬¬äºŒæ¬¡å°è¯•----é‡å†™å¯¼èˆªæ§åˆ¶å™¨  
æ—¢ç„¶ä»¥ä¸Šæ–¹å¼æ— æ³•è¾¾åˆ°åŠŸèƒ½ï¼Œé‚£ä¹ˆè¦ä¸å°±é‡å†™ä¸€ä¸ªå¯¼èˆªæ§åˆ¶å™¨ï¼Ÿ  å•Šå“ˆå“ˆ è¯´èµ·æ¥ç®€å• ä½†æ˜¯åšèµ·æ¥  å¯¼èˆªæ§åˆ¶å™¨éœ€è¦æ§åˆ¶å¾ˆå¤šçš„ç»†èŠ‚ï¼Œå¦‚æœé‡å†™çš„è¯ï¼Œé‚£ä¹ˆä¸»è¦æ˜¯å¯¼èˆªå¤´ï¼Œå¦‚ä½•é‡å†™   

### ç¬¬ä¸‰æ¬¡å°è¯•----åˆ©ç”¨runtimeæ¥å®ç°  
1. é€šè¿‡æ‰©å±•`UIViewController`çš„æ–¹å¼æ¥å®ç°  
	éœ€è¦æ·»åŠ åˆ©ç”¨runtimeæœºåˆ¶ï¼Œæ·»åŠ ä¸¤ä¸ªå±æ€§  
	* å¤´æ–‡ä»¶å®šä¹‰  
	
	~~~
	@property(nonatomic,strong) UIColor *titleColor;

	@property(nonatomic,strong) NSString *subTitle;

	//è®¾ç½®å¸¦æœ‰å›¾ç‰‡çš„titleå¹¶ä¸”å›¾ç‰‡æ·»åŠ äº‹ä»¶  
	-(void)setTitle:(NSString *)title titleIcon:(UIImage *)image iconAction:(SEL)action;
	~~~
	
	* å®ç°  
	
~~~objectivec
-(void)setTitle:(NSString *)title
{
    if([self isKindOfClass:[UIAlertController class]]){
        [self setValue:title forKey:@"_title"];
        
        return;
    }
    UIView *customView =  self.navigationItem.leftBarButtonItem.customView;
    if (customView == nil) {
        UIButton *label = [[UIButton alloc]init];
        label.tag = 1;
//        [label setText:title];
        [label setTitle:title forState:UIControlStateNormal];
        
        UIFont *font = [UIFont fontWithName:@"PingFangSC-Medium" size:20];
        if (!font) {
            font = [UIFont boldSystemFontOfSize:20];
        }
        label.titleLabel.lineBreakMode = NSLineBreakByTruncatingTail;
        [label.titleLabel setFont:font];
        [label sizeToFit];
        [label setTitleColor:[UIColor blackColor] forState:UIControlStateNormal];
        if(label.width > [UIScreen mainScreen].bounds.size.width *2 / 3)
        {
            label.width = [UIScreen mainScreen].bounds.size.width *1 / 3;
        }
        self.navigationItem.leftBarButtonItem = [[UIBarButtonItem alloc]initWithCustomView:label];
    }else if([customView isMemberOfClass:[UIButton class]])
    {
        UIButton *label = (UIButton *)customView;
//        [label setText:title];
        [label setTitle:title forState:UIControlStateNormal];
        [label.imageView setContentMode:UIViewContentModeScaleAspectFill];
        [label sizeToFit];
        [label setTitleColor:[UIColor blackColor] forState:UIControlStateNormal];
    }else
    {
        UIButton *label;
        for (UIView *subView in customView.subviews) {
            UIButton *subLabel = (UIButton *)subView;
            if (subLabel.tag  == 1) {
                label = subLabel;
            }
        }
//        [label setText:title];
        [label setTitle:title forState:UIControlStateNormal];
        [label setTitleColor:[UIColor blackColor] forState:UIControlStateNormal];
    }
//     [self.navigationItem.leftBarButtonItem.customView setBackgroundColor:[UIColor randomColor]];
}

-(void)setTitle:(NSString *)title titleIcon:(UIImage *)image iconAction:(SEL)action
{
    [self setTitle:title];
    UIImage *newImage = nil;
    if (image.size.width > 35 || image.size.height > 35) {
        newImage =[image scaleImageWithSize:CGSizeMake(35, 35) isCircle:YES];
    }else
    {
        newImage = [image scaleImageWithSize:image.size isCircle:YES];
    }
    
    UIView *customView =  self.navigationItem.leftBarButtonItem.customView;
    if (customView != nil && [customView isMemberOfClass:[UIButton class]]) {
        UIButton *label = (UIButton *)customView;
        [label setImage:newImage forState:UIControlStateNormal];
        [label.imageView setContentMode:UIViewContentModeScaleAspectFill];
        [label addTarget:self action:action forControlEvents:UIControlEventTouchUpInside];
        [label sizeToFit];
        if (label.width > [UIScreen mainScreen].bounds.size.width *2 / 3) {
            label.width =  [UIScreen mainScreen].bounds.size.width *2 / 3;
             label.imageEdgeInsets = UIEdgeInsetsMake(0, 0, 0, 15);
        }else
        {
             label.titleEdgeInsets = UIEdgeInsetsMake(0, 0, 0, -15);
        }
    }
}
-(void)setTitleColor:(UIColor *)titleColor
{
    objc_setAssociatedObject(self, IndieBandNameKey, titleColor, OBJC_ASSOCIATION_RETAIN_NONATOMIC);
    UIView *view = self.navigationItem.leftBarButtonItem.customView;
    if ([view isMemberOfClass:[UIButton class]]) {
        UIButton *label = (UIButton *)view;
        [label.titleLabel setTextColor:titleColor];
    }else
    {
        UIButton *label;
        for (UIView *subView in view.subviews) {
            UIButton *subLabel = (UIButton *)subView;
            if (subLabel.tag  == 1) {
                label = subLabel;
            }
        }
        
        [label.titleLabel setTextColor:titleColor];

    }
//     [self.navigationItem.leftBarButtonItem.customView setBackgroundColor:[UIColor randomColor]];
}

-(UIColor *)titleColor
{
      return objc_getAssociatedObject(self,IndieBandNameKey);
}

-(void)setSubTitle:(NSString *)subTitle
{
    objc_setAssociatedObject(self,IndieBandNameSubTitleKey , subTitle, OBJC_ASSOCIATION_RETAIN_NONATOMIC);
    
    UIView *view = self.navigationItem.leftBarButtonItem.customView;

    if ([view isMemberOfClass:[UIButton class]]) {
        UIView *backView = [[UIView alloc]init];
        
        UIButton *Label = (UIButton *)view;
        
        UIButton *titleLabel = [[UIButton alloc]init];
        titleLabel.tag = 1;
//        [titleLabel setText:Label.text];
        [titleLabel setTitle:Label.titleLabel.text forState:UIControlStateNormal];
        [titleLabel.titleLabel setFont:Label.titleLabel.font];
        [titleLabel sizeToFit];
        [titleLabel.imageView setContentMode:UIViewContentModeScaleAspectFill];
        [titleLabel setTitleColor:[UIColor blackColor] forState:UIControlStateNormal];
        if(titleLabel.width > [UIScreen mainScreen].bounds.size.width *2 / 3)
        {
            titleLabel.width = [UIScreen mainScreen].bounds.size.width *1 / 3;
        }
        
        UILabel *subTitleLabel = [[UILabel alloc]init];
        subTitleLabel.tag = 2;
         [subTitleLabel setText:subTitle];
        UIFont *font = [UIFont fontWithName:@"PingFangSC-Medium" size:10];
        if (!font) {
            font = [UIFont boldSystemFontOfSize:10];
        }
        
        [subTitleLabel setFont:font];
        [subTitleLabel sizeToFit];
        
        [backView addSubview:titleLabel];
        [backView addSubview:subTitleLabel];
        
        titleLabel.x = 0;
        subTitleLabel.x = titleLabel.width + 3;
        if (iPhone6Plus) {
             subTitleLabel.y = titleLabel.height - subTitleLabel.height - 10;
        }else if(iPhone6){
            subTitleLabel.y = titleLabel.height - subTitleLabel.height - 10;
        }else{
             subTitleLabel.y = titleLabel.height - subTitleLabel.height - 7;
        }
       
        
        backView.width =titleLabel.width + subTitleLabel.width + 5;
        backView.height = titleLabel.height;
        
//        [subTitleLabel setBackgroundColor:[UIColor randomColor]];
//        [backView setBackgroundColor:[UIColor randomColor]];
//        [titleLabel setBackgroundColor:[UIColor randomColor]];
        
        self.navigationItem.leftBarButtonItem = [[UIBarButtonItem alloc]initWithCustomView:backView];
    }
    else
    {
        UIButton *label;
        for (UIView *subView in view.subviews) {
            UIButton *subLabel = (UIButton *)subView;
            if (subLabel.tag  == 2) {
                label = subLabel;
            }
        }
        
        [label setTitle:subTitle forState:UIControlStateNormal];
        [label setTitleColor:[UIColor blackColor] forState:UIControlStateNormal];
    }
}

-(NSString *)subTitle
{
    return objc_getAssociatedObject(self,IndieBandNameSubTitleKey);
}

~~~
	ä»¥ä¸Šæ–¹å¼ä¹Ÿä¸æ˜¯å¾ˆéš¾ï¼Œ å°±æ˜¯ä¸€ç›´åœ¨åˆ¤æ–­`navigationItem.leftBarButtonItem`ä»¥åŠä¿®æ”¹å…¶ä¸­å­æ§ä»¶çš„è¿‡ç¨‹
	
  
	



2. åœ¨è‡ªå®šä¹‰çš„NavigationControllerä¸­é‡å†™`pushViewController:animated:`æ–¹æ³•ï¼Œ åœ¨å…¶ä¸­å¤„ç†æŒ‰é’®çš„ä¸ªæ•°ä»¥åŠè¿”å›æŒ‰é’®æ˜¯å¦æ˜¾ç¤ºçš„é—®é¢˜  

~~~objectivec
-(void)pushViewController:(UIViewController *)viewController animated:(BOOL)animated
{
    //å–æ¶ˆæ‰ç³»ç»Ÿçš„back item
    viewController.navigationItem.backBarButtonItem = [[UIBarButtonItem alloc]initWithCustomView:[[UIView alloc]init]];
    
    //pushæ“ä½œ  
    [super pushViewController:viewController animated:animated];
    //push å®Œæˆåå¤„ç†
    if ([self.viewControllers count] > 1) {
        UIButton *button = [UIButton buttonWithType:UIButtonTypeCustom];
        [button addTarget:self action:@selector(popButtonClick) forControlEvents:UIControlEventTouchUpInside];
        [button setImage:[UIImage imageNamed:@"topbar_back_btn_n"] forState:UIControlStateNormal];
        [button setImage:[UIImage imageNamed:@"topbar_back_btn_h"] forState:UIControlStateHighlighted];
        [button sizeToFit];
        UIBarButtonItem *item = [[UIBarButtonItem alloc]initWithCustomView:button];
        item.tag = 10008;
        //è¯´æ˜æœ¬èº«å°±æœ‰item (æ¯”å¦‚ï¼šæ›´å¤š item ç­‰å…¶ä»–item )
        if (viewController.navigationItem.rightBarButtonItems.count > 0) {
            NSMutableArray *mutableArray = [NSMutableArray arrayWithArray:viewController.navigationItem.rightBarButtonItems];
            [mutableArray insertObject:item atIndex:0];
            viewController.navigationItem.rightBarButtonItems = mutableArray.copy;
        }else
        {
            viewController.navigationItem.rightBarButtonItem = item;
        }
    }
}
~~~




è™½ç„¶ä¸Šè¾¹çš„æ–¹æ³•è§£å†³çš„é—®é¢˜ï¼Œä½†æ˜¯åˆå¼•å…¥äº†æ–°çš„é—®é¢˜ï¼š  
####1. å·¦æ»‘æ‰‹åŠ¿çš„æ¶ˆå¤±    
åœ¨è‡ªå®šä¹‰çš„å¯¼èˆªæ§åˆ¶å™¨çš„`viewDidLoad`æ–¹æ³•ä¸­é€šè¿‡ä»¥ä¸‹æ–¹å¼æ·»åŠ å·¦æ»‘æ‰‹åŠ¿  

~~~objectivec
  id target = self.interactivePopGestureRecognizer.delegate;
    UIScreenEdgePanGestureRecognizer *GestureRecognizer = [[UIScreenEdgePanGestureRecognizer alloc]initWithTarget:target action:@selector(handleNavigationTransition:)];
    GestureRecognizer.edges = UIRectEdgeLeft;
    GestureRecognizer.delegate = self;
    // ç»™å¯¼èˆªæ§åˆ¶å™¨çš„viewæ·»åŠ å…¨å±æ»‘åŠ¨æ‰‹åŠ¿
    [self.view addGestureRecognizer:GestureRecognizer];
    // ç¦æ­¢ä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦çš„æ»‘åŠ¨æ‰‹åŠ¿
    self.interactivePopGestureRecognizer.enabled = NO;
    //éšè—back item
    self.navigationItem.hidesBackButton = YES;
~~~
åŒæ—¶å®ç°ä»£ç†æ–¹æ³•ï¼Œç¦æ­¢åœ¨æ ¹æ§åˆ¶å™¨çš„æ—¶å€™å†è§¦å‘æ‰‹åŠ¿  

~~~objectivec
-(BOOL)gestureRecognizerShouldBegin:(UIGestureRecognizer *)gestureRecognizer
{
    if (self.childViewControllers.count == 1) {
        return NO;
    }
    return YES;
}
~~~ 

####2. å¤šæ¬¡è·³è½¬ä¼šå‡ºç°å¤šä¸ªè¿”å›æŒ‰é’®  
ç½‘ä¸Šçœ‹åˆ°æœ‰äººé€šè¿‡å¯¹`UIControl`è¿›è¡Œæ‰©å±•å®ç°ï¼Œè™½ç„¶è¿™ç§æ–¹å¼å¯ä»¥å®ç°ä½†æ˜¯å¹¶ä¸èƒ½é€šç”¨ï¼Œæ§åˆ¶å™¨çš„è·³è½¬æ˜¯å¯ä»¥é€šè¿‡å¤šç§å½¢å¼å®ç°çš„ï¼Œæ¯”å¦‚é¡¶éƒ¨item ï¼ŒUIbutton ï¼Œ UITableViewCell ç­‰ç­‰æ–¹å¼å®ç°ï¼Œæ‰€ä»¥æœ€å¥½çš„æ–¹å¼æ˜¯åœ¨å¯¼èˆªæ§åˆ¶å™¨ä¸­å®ç°å¤„ç†  

åœ¨`- (void)pushViewController:(UIViewController *)viewController animated:(BOOL)animated`æ–¹æ³•ä¸­å®ç°é™åˆ¶  

~~~objectivec
- (void)pushViewController:(UIViewController *)viewController animated:(BOOL)animated
 {
   //æ­¤å¤„ä»£ç å¯ä»¥ä¸éœ€è¦
   if ([self respondsToSelector:@selector(interactivePopGestureRecognizer)]) {
      self.interactivePopGestureRecognizer.enabled = NO;
    }
    
    //ä¸»è¦åœ¨æ­¤å¤„ä»£ç ,å®šä¹‰ä¸€ä¸ªå±æ€§ï¼Œå½“push çš„æ—¶å€™åˆ¤æ–­æ˜¯å¦ä¸ºyes
    if (self.pushing) {
        return;  
    }
    
    //å…·ä½“çš„å¤„ç†ä¸šåŠ¡  
    
    [super pushViewController:viewController animated:animated];
    self.pushing = yes;
}
~~~


éœ€è¦åœ¨ä»£ç æ–¹æ³•ä¸­åœ¨pushåŠ¨ä½œå®Œæˆåï¼Œå°†å…¶è®¾ç½®ä¸ºNO  

~~~objectivec
-(void)navigationController:(UINavigationController *)navigationController didShowViewController:(UIViewController *)viewController animated:(BOOL)animated{
    self.pushing = NO;   
}
~~~

### æ€»ç»“  
ä»¥ä¸Šå°±æ˜¯è§£å†³æ–¹æ¡ˆäº†ï¼Œå¦‚æœæœ‰æ›´å¥½çš„æ–¹å¼å®ç°ï¼Œè¿˜å¸Œæœ›èƒ½å‘ŠçŸ¥äºæˆ‘   
__é¡¹ç›®èµ¶å¾—å¤ªç´§ï¼Œä»£ç å†™çš„æœ‰ç‚¹æ¸£ï¼Œå–·è¯·è½»å–·ï¼Œ å•Šå“ˆå“ˆ__












