# iOS命令行工具开发  

## Q&A 
1. 命令行工具的本质  
    * 可执行文件  
    * 跟APP内部的可执行文件相似  
2. 权限问题  
    签名 - 给可执行文件签上一定的权限，让他可以访问其他APP的可执行文件   
    ```
    // 导出权限  
    ldid -e  XXXX二进制  > XXX.entitlements 
    // 签新权限 
    ldid -Sxxxx.entitlements XXXX
    ```
    > 如何获取适当的权限呢？将知道的有权限的文件权限导出，然后复制到新的可执行文件上  此处获取的是SprintBoot 程序的   
    

## 实践  
1. 创建项目  
    创建APP项目   
2. 修改项目   
    * 删除其他资源文件，留`main.m` 和 `plist` 文件
    ```Objective-C 
    int main() {
        @autoreleasepool {
            // 具体代码实现  
            return 0;
        }
    }
    ```
3. 功能实现  
    * 判断二进制文件类型  
        ```Objective-C  
        // 需要结合 Xun 源码，判断二进制类型  
        #import <mach-o/fat.h> 
        #import <mach-o/loader.h>  


        NSString *apppath =@""; 
        NSFileHander *hander = [NSFileHandler fileHandleForReadingAtPath:apppath]; 
        // 读取前4个字节  
        int length = sizeof(uint32_t); 
        NSData *magicData = [handle readDataOfLenght:length]; 

        // 转为 uint32_t 类型 
        uint32_t magicNumber; 
        [magicData getBytes:&magicNumber length:lenght]; 

        // 一个是高地址读， 一个是第地址读  
        if(magicNumber == FAT_CIGAM || magicNumber == FAT_MAGIC) {
            // Fat 文件 
        }else if(magicNumber == MH_MAGIC || magicNumber == MH_CIGAM) {
            // 非 64 bit 架构文件  
        }else if(magicNumber == MH_MAGIC_64 || magicNumber == MH_CIGAM_64) {
                // 64 架构  
        }else {
            // 读取失败
        }

        [handle closeFile];
        ```
    * 参数处理  
        ```Objective-C 
        // main 方法的参数： 
        // argc: 参数的个数  
        // argv[0]: 当前可执行文件的路径  

        if(argc == 1)  {
            // 只有一次参数，那就是可执行文件路径  
            printf("-l 查看MachO信息\n"); 
            return 0;
        }
        // 比较字符串  
        if (strcmp(argv[1],"-l") == 0) {

        }
        ```