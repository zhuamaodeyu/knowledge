# 苹果文件系统指南 

## 简介 
Apple 文件系统是适用于 iOS、macOS、tvOS 和 watchOS 的全新现代文件系统。它针对闪存/SSD 存储进行了优化，具有强大的加密、写入时复制元数据、空间共享、文件和目录克隆、快照、快速目录大小调整、原子安全保存原语以及改进的文件系统基础知识。

APFS 取代 HFS+ 作为 iOS 10.3 及更高版本以及 macOS High Sierra 及更高版本的默认文件系统。


## 特征 
Apple 文件系统是一个 64 位文件系统，支持单个卷上超过 9 个五亿个文件。这种最先进的文件系统具有文件和目录克隆、快照、空间共享、快速目录大小调整、原子安全保存原语和改进的文件系统基础知识，以及使用独特的写时复制设计I/O 合并可提供最大性能，同时确保数据可靠性。


## 加密 

安全和隐私是 Apple 文件系统设计的基础。这就是 Apple 文件系统实施强大的全盘加密、加密文件和所有敏感元数据的原因。 
可用的加密方法取决于硬件和操作系统支持，并且对于 Mac、iPhone、iPad、Apple TV 和 Apple Watch 可能有所不同。

Apple 文件系统支持容器中每个卷的以下加密模型：
* 无加密 
* 单密钥加密 
* 多密钥加密，其中文件数据的每个文件密钥和敏感元数据的单独密钥  

多密钥加密保证用户数据的完整性。即使有人破坏设备的物理安全并获得设备密钥的访问权限，他们仍然无法解密用户的文件。

Apple 文件系统使用 AES-XTS 或 AES-CBC 加密模式，__具体取决于硬件__  


## 崩溃保护 
Apple 文件系统使用新颖的写入时复制元数据方案来确保文件系统的更新具有崩溃保护，没有日记的写入两次开销  



## 快速调整目录大小 
快速目录大小调整允许 Apple 文件系统快速计算目录层次结构使用的总空间，并随着层次结构的变化进行更新。   

快速目录大小调整的工作原理是在添加和删除内容时预先计算目录的大小。因此，它最适合包含许多文件且变动相对较小的目录。例如，用户的文档文件夹是快速调整目录大小的良好候选者，而/tmp目录则不然。


文件系统可以在空目录上启用快速目录大小调整。您无法直接对包含文件的目录或其他目录启用快速目录大小调整；您必须首先创建一个新目录，对其启用快速目录大小调整，然后将现有目录的内容移动到新目录。



## 保存的原子级安全 
Apple 文件系统为`bundles`和`directories`引入了新的原子安全保存。原子安全保存在单个事务中执行重命名，这样，从用户的角度来看，操作要么完成，要么根本不发生。


## 常见问题 

### 兼容性 
1. 以将 Apple 文件系统与我现有的硬盘驱动器一起使用吗？  
    是的。Apple 文件系统针对闪存/SSD 存储进行了优化，但也可与传统硬盘驱动器 (HDD) 和外部直连存储一起使用。  
2. 我可以使用网络文件共享协议重新共享 APFS 格式的卷吗？  
    是的，您可以使用 SMB 或 NFS 网络文件共享协议共享 APFS 格式的卷。
    您无法使用 AFP 共享 APFS 格式的卷。AFP 协议已弃用。
3. 我可以将第三方磁盘实用程序与 APFS 格式的硬盘一起使用吗？ 
    需要更新支持支持 Apple 文件系统 
4. 可以从 APFS 格式的硬盘启动 macOS High Sierra 吗？  
    是的。macOS High Sierra 支持可启动卷和数据卷的 Apple 文件系统。




